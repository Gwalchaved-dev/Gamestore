{% extends 'base.html.twig' %}

{% block title %}
    Nos Jeux Vidéos
{% endblock %}

{% block body %}
    <section>
        <div class="container my-4">
            <div class="row">
                {# Parcours les jeux depuis la base de données #}
                {% for jeu in jeux %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <img src="{{ asset('uploads/images/' ~ jeu.image) }}" class="card-img-top" alt="{{ jeu.titre }}">
                        <div class="card-body">
                            <h5 class="card-title sarpanch-semibold">{{ jeu.titre }}</h5>
                            <p class="card-text pt-mono-regular">{{ jeu.description|slice(0, 100) }}...</p>
                            <button type="button" class="btn btn-primary sarpanch-semibold" data-bs-toggle="modal" data-bs-target="#gameModal{{ jeu.id }}">Voir fiche</button>
                        </div>
                    </div>
                </div>

                {# Modal pour chaque jeu #}
                <div class="modal fade" id="gameModal{{ jeu.id }}" tabindex="-1" aria-labelledby="gameModalLabel{{ jeu.id }}" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title sarpanch-semibold" id="gameModalLabel{{ jeu.id }}">{{ jeu.titre }}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body d-flex">
                                <div class="main-image" style="flex: 1;">
                                    <img id="mainImage{{ jeu.id }}" src="{{ asset('uploads/images/' ~ jeu.image) }}" class="img-fluid modal-img" alt="Image du jeu">
                                </div>
                                <div class="details" style="flex: 1; padding-left: 20px;">
                                    <div class="image-gallery d-flex justify-content-center mb-3">
                                        {# Images supplémentaires avec la possibilité de changer l'image principale #}
                                        {% if jeu.secondImage %}
                                            <img src="{{ asset('uploads/images/' ~ jeu.secondImage) }}" class="img-thumbnail selectable-img" alt="{{ jeu.titre }}" data-main-image="#mainImage{{ jeu.id }}" style="width: 50px;">
                                        {% endif %}
                                        {% if jeu.thirdImage %}
                                            <img src="{{ asset('uploads/images/' ~ jeu.thirdImage) }}" class="img-thumbnail selectable-img" alt="{{ jeu.titre }}" data-main-image="#mainImage{{ jeu.id }}" style="width: 50px;">
                                        {% endif %}
                                    </div>
                                    <p class="game-description pt-mono-regular">{{ jeu.description }}</p>
                                    <p class="game-price sarpanch-semibold">Prix : {{ jeu.prix }}€</p>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>

                                {# Vérifier si l'utilisateur est authentifié ou non #}
                                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                                    {# Si l'utilisateur est connecté, afficher le bouton "Acheter" #}
                                    <form method="post" action="{{ path('ajouter_panier', {id: jeu.id}) }}">
                                        <button type="submit" class="btn btn-primary">Acheter</button>
                                    </form>
                                {% else %}
                                    {# Si l'utilisateur n'est pas connecté, afficher le bouton "S'inscrire" #}
                                    <a href="{{ path('app_register') }}" class="btn btn-primary">S'inscrire</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    {# Inclusion du script JavaScript pour gérer le changement d'image dans la modal #}
    <script src="{{ asset('build/galerieModal.js') }}"></script>
{% endblock %}