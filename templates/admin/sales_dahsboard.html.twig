{% extends 'base.html.twig' %}

{% block title %}Sales Dashboard{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h1>Sales Dashboard</h1>

        <form id="filter-form" method="get" class="mb-3">
            <div class="row">
                <div class="col-md-6">
                    <label for="filter-type">Filter by:</label>
                    <select id="filter-type" name="filter_type" class="form-control">
                        <option value="game">Game</option>
                        <option value="genre">Genre</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="filter-value">Select:</label>
                    <select id="filter-value" name="filter_value" class="form-control">
                        {% if filter_type == 'game' %}
                            {% for game in games %}
                                <option value="{{ game.name }}">{{ game.name }}</option>
                            {% endfor %}
                        {% elseif filter_type == 'genre' %}
                            {% for genre in genres %}
                                <option value="{{ genre }}">{{ genre }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                </div>
            </div>
        </form>

        <div class="chart-container">
            <canvas id="salesChart"></canvas>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.getElementById('filter-type').addEventListener('change', function () {
            document.getElementById('filter-form').submit();
        });

        const salesData = {
            labels: {{ sales_dates|json_encode() }},
            datasets: [{
                label: 'Sales ({{ filter_value }})',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1,
                data: {{ sales_data|json_encode() }},
            }]
        };

        const config = {
            type: 'line',
            data: salesData,
            options: {
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Copies Sold'
                        }
                    }
                },
                responsive: true,
            }
        };

        const salesChart = new Chart(
            document.getElementById('salesChart'),
            config
        );
    </script>
{% endblock %}